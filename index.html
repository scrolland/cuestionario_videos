<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experimento: Detecci√≥n de Videos Generados por IA</title>
    <style>
        /* Variables CSS */
        :root {
            --primary-color: #1a5490;
            --secondary-color: #2c7ab5;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --text-dark: #2c3e50;
            --bg-light: #ecf0f1;
            --bg-white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            color: var(--text-dark);
            background-color: var(--bg-light);
        }

        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        header h1 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 1.6rem;
            font-weight: 600;
        }

        header .subtitle {
            margin: 0;
            font-size: 1rem;
            opacity: 0.9;
            font-style: italic;
        }

        header .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .experiment-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0.5rem;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin: 0.5rem auto;
            background-color: #000;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .video-container iframe {
            width: 100%;
            height: 400px;
            display: block;
            border: none;
        }

        .slider-container {
            margin: 0.5rem 0;
            padding: 0.75rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 4px;
        }

        .slider-container h3 {
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .label-real {
            color: var(--success-color);
        }

        .label-fake {
            color: var(--danger-color);
        }

        .slider-track {
            position: relative;
            height: 50px;
            margin: 0.5rem 0;
        }

        .slider-input {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right,
                #27ae60 0%, #27ae60 20%,
                #95a5a6 50%,
                #e74c3c 80%, #e74c3c 100%);
            outline: none;
            -webkit-appearance: none;
            margin: 20px 0;
        }

        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-color);
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .slider-input::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 14px rgba(0,0,0,0.4);
        }

        .slider-input::-moz-range-thumb {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-color);
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .slider-value-display {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            margin: 0.25rem 0;
            color: var(--primary-color);
        }

        .slider-markers {
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            margin-top: -10px;
        }

        .marker {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-light);
        }

        .progress-info {
            text-align: center;
            padding: 0.4rem;
            background-color: #e3f2fd;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .progress-info h3 {
            margin: 0;
            color: var(--primary-color);
            font-size: 0.85rem;
        }

        .progress-bar-container {
            width: 100%;
            height: 25px;
            background-color: var(--bg-light);
            border-radius: 12px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--success-color) 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .btn-next {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-next:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .form-group {
            margin-bottom: 0.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .form-group select,
        .form-group input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .instructions-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .instructions-box h3 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .instructions-box ul {
            margin-left: 1.5rem;
        }

        .instructions-box li {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .thank-you-message {
            text-align: center;
            padding: 3rem;
        }

        .thank-you-message h2 {
            color: var(--success-color);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .consent-box {
            background-color: white;
            border: 2px solid var(--border-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .consent-box label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .consent-box input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 1rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Experimento: Detecci√≥n de Videos Generados por IA</h1>
            <p class="subtitle">Universidad - Estudio sobre percepci√≥n de contenido sint√©tico</p>
        </div>
    </header>

    <main class="container experiment-container">
        <!-- PASO 1: Introducci√≥n y consentimiento -->
        <div id="step-intro" class="step active">
            <div class="section">
                <div style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); padding: 1.5rem; border-radius: 8px; color: white; text-align: center; margin-bottom: 1.5rem;">
                    <h2 style="margin: 0; font-size: 1.8rem;">üé¨ Experimento de Detecci√≥n de Videos IA</h2>
                </div>

                <div class="instructions-box">
                    <h3 style="text-align: center;">üìã Informaci√≥n sobre el Estudio</h3>
                    <p><strong>Investigador Principal:</strong> Silvia Charles Roland (scrolland@hotmail.com)</p>
                    <p><strong>N√∫mero de videos a evaluar:</strong> 20 videos</p>
                    <p><strong>Duraci√≥n estimada:</strong> 10-15 minutos</p>

                    <h4>Objetivo del Estudio:</h4>
                    <p>Este experimento busca entender c√≥mo las personas perciben y distinguen entre videos reales y videos generados por inteligencia artificial.</p>

                    <h4>Tem√°tica de los Videos:</h4>
                    <p>Los videos que ver√°s muestran <strong>situaciones tur√≠sticas</strong>: paisajes, monumentos, personas en entornos vacacionales, escenas de viajes, etc. Ver√°s tanto contenido de entretenimiento como informativo relacionado con destinos y experiencias tur√≠sticas.</p>

                    <h4>¬øQu√© tendr√°s que hacer?</h4>
                    <ul>
                        <li><strong>Ver√°s 20 videos</strong> cortos (cada uno dura entre 5-10 segundos)</li>
                        <li>Para cada video, deber√°s <strong>indicar si crees que es REAL o FAKE (generado por IA)</strong></li>
                        <li>Si consideras que el video es <strong>FAKE</strong>, te pediremos que valores 3 aspectos usando sliders del 0 al 10:
                            <ul>
                                <li><strong>Coherencia de elementos visuales en primer plano</strong></li>
                                <li><strong>Naturalidad del movimiento</strong></li>
                                <li><strong>Coherencia de iluminaci√≥n y sombras</strong></li>
                            </ul>
                            <small>(0 = Muy mal / Muy artificial | 10 = Perfecto / Muy natural)</small>
                        </li>
                        <li>No hay respuestas correctas o incorrectas, queremos tu <strong>percepci√≥n honesta</strong></li>
                    </ul>

                    <h4>Uso de los Datos:</h4>
                    <p>Tus respuestas ser√°n completamente <strong>an√≥nimas</strong> y se utilizar√°n √∫nicamente con fines de investigaci√≥n acad√©mica. Los datos se almacenar√°n de forma segura y no se compartir√°n identificadores personales.</p>
                </div>

                <div class="consent-box">
                    <label>
                        <input type="checkbox" id="consent-check" required>
                        <span>He le√≠do la informaci√≥n del estudio y acepto participar voluntariamente. Entiendo que puedo abandonar el experimento en cualquier momento.</span>
                    </label>
                </div>

                <h3>Datos Demogr√°ficos</h3>
                <div class="form-group">
                    <label for="genero">G√©nero *</label>
                    <select id="genero" required>
                        <option value="">Selecciona...</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Femenino">Femenino</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="edad">Edad *</label>
                    <input type="number" id="edad" min="18" max="99" required placeholder="Ej: 25">
                </div>

                <div class="form-group">
                    <label for="consumo-videos">Nivel de consumo habitual de videos *</label>
                    <select id="consumo-videos" required>
                        <option value="">Selecciona...</option>
                        <option value="Muy poco/nada">Muy poco/nada</option>
                        <option value="Habitualmente/Muy habitualmente">Habitualmente/Muy habitualmente</option>
                    </select>
                </div>

                <button class="btn-next" onclick="startExperiment()">Comenzar Experimento</button>
            </div>
        </div>

        <!-- PASO 2: Videos -->
        <div id="step-videos" class="step">
            <div class="progress-info">
                <h3>Video <span id="current-video">1</span> de 20</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-bar" style="width: 5%;">5%</div>
                </div>
            </div>

            <div class="video-container">
                <iframe id="video-player" src="" allow="autoplay"></iframe>
            </div>

            <!-- Pregunta principal: Real o Fake -->
            <div class="slider-container">
                <h3>¬øEste video es real o generado por IA?</h3>
                <div style="display: flex; justify-content: center; gap: 2rem; margin: 1rem 0;">
                    <label style="display: flex; align-items: center; padding: 1rem 2rem; background: #f8f9fa; border-radius: 8px; cursor: pointer; border: 3px solid transparent; transition: all 0.2s;" id="label-real">
                        <input type="radio" name="respuesta-tipo" value="real" style="margin-right: 0.75rem; width: 22px; height: 22px; cursor: pointer;" onchange="onTipoChange('real')">
                        <span style="font-size: 1.1rem; font-weight: 600; color: var(--success-color);">REAL</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 1rem 2rem; background: #f8f9fa; border-radius: 8px; cursor: pointer; border: 3px solid transparent; transition: all 0.2s;" id="label-fake">
                        <input type="radio" name="respuesta-tipo" value="fake" style="margin-right: 0.75rem; width: 22px; height: 22px; cursor: pointer;" onchange="onTipoChange('fake')">
                        <span style="font-size: 1.1rem; font-weight: 600; color: var(--danger-color);">FAKE (IA)</span>
                    </label>
                </div>
            </div>

            <!-- Sliders condicionales (solo si elige FAKE) -->
            <div id="sliders-fake-container" class="slider-container" style="display: none;">
                <h3 style="margin-bottom: 1rem;">Valora los siguientes aspectos del video:</h3>
                <p style="text-align: center; color: var(--text-light); margin-bottom: 1rem;">
                    <small>0 = Muy mal / Muy artificial | 10 = Perfecto / Muy natural</small>
                </p>

                <!-- Slider 1: Coherencia elementos visuales -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Coherencia de los elementos visuales en primer plano</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 0.8rem; color: var(--danger-color);">0</span>
                        <input type="range" id="slider-coherencia" class="slider-input" min="0" max="10" value="5" oninput="updateSliderDisplay('coherencia', this.value)" style="flex: 1;">
                        <span style="font-size: 0.8rem; color: var(--success-color);">10</span>
                        <span id="value-coherencia" style="font-weight: bold; min-width: 30px; text-align: center;">5</span>
                    </div>
                </div>

                <!-- Slider 2: Naturalidad movimiento -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Naturalidad del movimiento observado en el video</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 0.8rem; color: var(--danger-color);">0</span>
                        <input type="range" id="slider-movimiento" class="slider-input" min="0" max="10" value="5" oninput="updateSliderDisplay('movimiento', this.value)" style="flex: 1;">
                        <span style="font-size: 0.8rem; color: var(--success-color);">10</span>
                        <span id="value-movimiento" style="font-weight: bold; min-width: 30px; text-align: center;">5</span>
                    </div>
                </div>

                <!-- Slider 3: Coherencia iluminacion -->
                <div style="margin-bottom: 0.5rem;">
                    <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Coherencia de la iluminacion y las sombras del video</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 0.8rem; color: var(--danger-color);">0</span>
                        <input type="range" id="slider-iluminacion" class="slider-input" min="0" max="10" value="5" oninput="updateSliderDisplay('iluminacion', this.value)" style="flex: 1;">
                        <span style="font-size: 0.8rem; color: var(--success-color);">10</span>
                        <span id="value-iluminacion" style="font-weight: bold; min-width: 30px; text-align: center;">5</span>
                    </div>
                </div>
            </div>

            <button class="btn-next" onclick="nextVideo()">Siguiente Video ‚Üí</button>
        </div>

        <!-- PASO 3: Finalizaci√≥n -->
        <div id="step-thanks" class="step">
            <div class="section thank-you-message" style="text-align: center;">
                <div style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); padding: 2rem; border-radius: 12px; color: white; margin: 1rem 0;">
                    <h2 style="font-size: 2rem; margin-bottom: 1rem;">¬°Experimento Completado!</h2>
                    <p style="font-size: 1.1rem; margin: 0;">
                        Tus respuestas han sido guardadas exitosamente
                    </p>
                </div>

                <!-- Resultados del participante -->
                <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border-left: 4px solid #ff9800;">
                    <h3 style="color: #e65100; text-align: center; margin-bottom: 1rem;">Tus Resultados</h3>
                    <p style="font-size: 1.5rem; font-weight: bold; text-align: center; margin: 0.5rem 0;">
                        Aciertos: <span id="resultado-aciertos" style="color: var(--success-color);">0</span> / <span id="resultado-total">20</span>
                    </p>
                    <p style="font-size: 1.2rem; text-align: center; color: #666;">
                        (<span id="resultado-porcentaje">0</span>% de acierto)
                    </p>
                </div>

                <!-- Videos fallados -->
                <div id="videos-fallados-container" style="background: #fff; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border: 2px solid #e0e0e0; text-align: left; display: none;">
                    <h3 style="color: var(--danger-color); text-align: center; margin-bottom: 1rem;">Videos en los que fallaste</h3>
                    <div id="lista-videos-fallados" style="max-height: 300px; overflow-y: auto;">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; text-align: left;">
                    <h3 style="color: var(--primary-color); text-align: center; margin-bottom: 1rem;">Sobre el Estudio</h3>
                    <p style="margin: 0.5rem 0;">Los videos inclu√≠an grabaciones reales y contenido generado por IA con diferentes niveles de calidad.</p>
                    <p style="margin: 0.5rem 0;"><strong>Objetivo:</strong> Investigar c√≥mo las personas detectan contenido sint√©tico y qu√© caracter√≠sticas visuales despiertan sospechas.</p>
                </div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                    <p style="margin: 0; font-size: 0.95rem;">
                        <strong>Investigador Principal:</strong> Silvia Charles Roland<br>
                        <strong>Universidad:</strong> Universitat de les Illes Balears<br>
                        <strong>Contacto:</strong> <a href="mailto:scrolland@hotmail.com">scrolland@hotmail.com</a>
                    </p>
                </div>

                <p style="margin-top: 2rem; font-size: 1.1rem; color: var(--success-color); font-weight: 600;">
                    ¬°Gracias por contribuir a esta investigacion!
                </p>
            </div>
        </div>
    </main>

    <script>
        // State management
        let experimentState = {
            participanteId: null,
            currentVideo: 0,
            videos: [],
            responses: [],
            startTime: null,
            videoStartTime: null,
            isSubmitting: false
        };

        // Funci√≥n para manejar cambio de tipo (Real/Fake)
        function onTipoChange(tipo) {
            const slidersFakeContainer = document.getElementById('sliders-fake-container');
            const labelReal = document.getElementById('label-real');
            const labelFake = document.getElementById('label-fake');

            // Resetear estilos
            labelReal.style.border = '3px solid transparent';
            labelFake.style.border = '3px solid transparent';

            if (tipo === 'fake') {
                slidersFakeContainer.style.display = 'block';
                labelFake.style.border = '3px solid var(--danger-color)';
                labelFake.style.background = '#ffebee';
            } else {
                slidersFakeContainer.style.display = 'none';
                labelReal.style.border = '3px solid var(--success-color)';
                labelReal.style.background = '#e8f5e9';
            }
        }

        // Funci√≥n para actualizar display de sliders
        function updateSliderDisplay(tipo, value) {
            document.getElementById('value-' + tipo).textContent = value;
        }

        // Start experiment
        async function startExperiment() {
            // Validate inputs
            const consent = document.getElementById('consent-check').checked;
            const genero = document.getElementById('genero').value;
            const edad = document.getElementById('edad').value;
            const consumoVideos = document.getElementById('consumo-videos').value;

            if (!consent) {
                alert('Debes aceptar el consentimiento informado para continuar.');
                return;
            }

            if (!genero || !edad || !consumoVideos) {
                alert('Por favor completa todos los campos demogr√°ficos.');
                return;
            }

            if (edad < 18) {
                alert('Debes ser mayor de 18 a√±os para participar en este experimento.');
                return;
            }

            // Initialize experiment
            experimentState.participanteId = 'P' + Date.now();
            experimentState.genero = genero;
            experimentState.edad = parseInt(edad);
            experimentState.consumoVideos = consumoVideos;
            experimentState.videos = selectVideosForExperiment();
            experimentState.startTime = Date.now();

            // Show videos step
            document.getElementById('step-intro').classList.remove('active');
            document.getElementById('step-videos').classList.add('active');

            // Load first video
            loadVideo(0);
        }

        // Load video
        function loadVideo(index) {
            if (index >= experimentState.videos.length) {
                finishExperiment();
                return;
            }

            experimentState.currentVideo = index;
            experimentState.videoStartTime = Date.now();

            const video = experimentState.videos[index];
            const videoPlayer = document.getElementById('video-player');
            videoPlayer.src = video.path;

            // Reset radio buttons Real/Fake
            const radios = document.querySelectorAll('input[name="respuesta-tipo"]');
            radios.forEach(radio => radio.checked = false);

            // Reset estilos de labels
            const labelReal = document.getElementById('label-real');
            const labelFake = document.getElementById('label-fake');
            labelReal.style.border = '3px solid transparent';
            labelReal.style.background = '#f8f9fa';
            labelFake.style.border = '3px solid transparent';
            labelFake.style.background = '#f8f9fa';

            // Ocultar sliders condicionales
            document.getElementById('sliders-fake-container').style.display = 'none';

            // Reset sliders a valor 5
            document.getElementById('slider-coherencia').value = 5;
            document.getElementById('slider-movimiento').value = 5;
            document.getElementById('slider-iluminacion').value = 5;
            document.getElementById('value-coherencia').textContent = '5';
            document.getElementById('value-movimiento').textContent = '5';
            document.getElementById('value-iluminacion').textContent = '5';

            // Update progress
            const progress = ((index + 1) / experimentState.videos.length) * 100;
            document.getElementById('current-video').textContent = index + 1;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-bar').textContent = Math.round(progress) + '%';
        }

        // Next video
        async function nextVideo() {
            const respuestaTipoRadio = document.querySelector('input[name="respuesta-tipo"]:checked');
            const timeSpent = Math.round((Date.now() - experimentState.videoStartTime) / 1000);

            // Validar que haya seleccionado Real o Fake
            if (!respuestaTipoRadio) {
                alert('Por favor, indica si el video es REAL o FAKE.');
                return;
            }

            const respuestaTipo = respuestaTipoRadio.value; // 'real' o 'fake'
            const currentVideo = experimentState.videos[experimentState.currentVideo];

            // Obtener valores de sliders (solo relevantes si eligi√≥ fake)
            let sliderCoherencia = null;
            let sliderMovimiento = null;
            let sliderIluminacion = null;

            if (respuestaTipo === 'fake') {
                sliderCoherencia = parseInt(document.getElementById('slider-coherencia').value);
                sliderMovimiento = parseInt(document.getElementById('slider-movimiento').value);
                sliderIluminacion = parseInt(document.getElementById('slider-iluminacion').value);
            }

            // Determinar si acert√≥
            const esRealElVideo = !currentVideo.es_fake;
            const usuarioDijoReal = respuestaTipo === 'real';
            const acierto = esRealElVideo === usuarioDijoReal;

            // Save response with all fields
            const response = {
                numero: experimentState.currentVideo + 1,
                path: currentVideo.path,
                tipo_contenido: currentVideo.tipo,
                es_fake_real: currentVideo.es_fake,
                evidente: currentVideo.es_evidente || false,
                calidad: currentVideo.quality || currentVideo.calidad || 'desconocida',
                respuesta_usuario: respuestaTipo,
                acierto: acierto,
                slider_coherencia: sliderCoherencia,
                slider_movimiento: sliderMovimiento,
                slider_iluminacion: sliderIluminacion,
                tiempo: Math.round(timeSpent),
                es_placebo: currentVideo.es_evidente || false
            };

            experimentState.responses.push(response);

            // Load next video or finish
            loadVideo(experimentState.currentVideo + 1);
        }

        // Finish experiment
        async function finishExperiment() {
            // Prevenir env√≠os m√∫ltiples
            if (experimentState.isSubmitting) {
                console.log('Ya se est√° enviando, ignorando llamada duplicada');
                return;
            }

            experimentState.isSubmitting = true;

            // Calcular resultados
            const totalVideos = experimentState.responses.length;
            const aciertos = experimentState.responses.filter(r => r.acierto).length;
            const porcentaje = Math.round((aciertos / totalVideos) * 100);
            const videosFallados = experimentState.responses.filter(r => !r.acierto);

            const data = {
                participante_id: experimentState.participanteId,
                genero: experimentState.genero,
                edad: experimentState.edad,
                consumo_videos: experimentState.consumoVideos,
                fecha_inicio: new Date(experimentState.startTime).toISOString(),
                fecha_finalizacion: new Date().toISOString(),
                total_aciertos: aciertos,
                total_videos: totalVideos,
                porcentaje_acierto: porcentaje,
                respuestas: experimentState.responses
            };

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                // Mostrar resultados
                mostrarResultados(aciertos, totalVideos, porcentaje, videosFallados);

                document.getElementById('step-videos').classList.remove('active');
                document.getElementById('step-thanks').classList.add('active');

            } catch (error) {
                console.error('Error:', error);
                mostrarResultados(aciertos, totalVideos, porcentaje, videosFallados);
                document.getElementById('step-videos').classList.remove('active');
                document.getElementById('step-thanks').classList.add('active');
            }
        }

        // Mostrar resultados en pantalla final
        function mostrarResultados(aciertos, total, porcentaje, videosFallados) {
            document.getElementById('resultado-aciertos').textContent = aciertos;
            document.getElementById('resultado-total').textContent = total;
            document.getElementById('resultado-porcentaje').textContent = porcentaje;

            // Si hay videos fallados, mostrar la lista
            if (videosFallados.length > 0) {
                const container = document.getElementById('videos-fallados-container');
                const lista = document.getElementById('lista-videos-fallados');
                container.style.display = 'block';

                let html = '';
                videosFallados.forEach((video, index) => {
                    const realOFake = video.es_fake_real ? 'FAKE (IA)' : 'REAL';
                    const colorRespuesta = video.es_fake_real ? 'var(--danger-color)' : 'var(--success-color)';
                    const tuRespuesta = video.respuesta_usuario === 'real' ? 'REAL' : 'FAKE';

                    html += `
                        <div style="padding: 0.75rem; margin-bottom: 0.5rem; background: #f8f9fa; border-radius: 6px; border-left: 4px solid ${colorRespuesta};">
                            <p style="margin: 0; font-weight: 600;">Video ${video.numero}</p>
                            <p style="margin: 0.25rem 0; font-size: 0.9rem;">
                                Tu respuesta: <strong>${tuRespuesta}</strong> |
                                Correcto: <strong style="color: ${colorRespuesta};">${realOFake}</strong>
                            </p>
                        </div>
                    `;
                });

                lista.innerHTML = html;
            }
        }

        // CONFIGURACI√ìN GOOGLE SHEETS
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzwJskx0d2S5frpxSa7Tzap9We1UwdU8qvfXu2Ha-Nol6wCk9M_SIPL7aUQmlgoHn77/exec';

        // Configuraci√≥n de videos
        // Helper function para crear URL de Google Drive con autoplay
        const driveUrl = (id) => `https://drive.google.com/file/d/${id}/preview`;

        // NUEVA ESTRUCTURA: 3 carpetas (fakes, reales, placebo)
        // Carpeta: https://drive.google.com/drive/u/2/folders/1iwUNV-Z2t6GViM4FDRI0TbKpeTdACH5b
        const VIDEOS_POOL = {
            // Videos FAKE (generados por IA) - f1 a f65
            fakes: [
                driveUrl('1-pW22KbFzikhmz_a88fiolFcMY74Xz3U'),  // f1
                driveUrl('12HPaz4Z2y61_EKT3b5qHcQKa-I4BoE72'),  // f2
                driveUrl('130kRIH6WgJYQEiFppmNLaZKHYXLBRb-7'),  // f3
                driveUrl('13CTm7WGTbIef0e25oD-jW55Mey4Ri-3u'),  // f4
                driveUrl('13H_GLS5y7FGy5E4z5t6AELBjwZ_VCg2I'),  // f5
                driveUrl('14c-tDZ9V0UaWvgZoFhT_o59xMdYmszt1'),  // f6
                driveUrl('15hBNTslPqWEPpJk84Gttqoa40keKaCDi'),  // f7
                driveUrl('16Pi7UzRwxiQyCjnoqgKTo9xod2RtaFiD'),  // f8
                driveUrl('182bkRMeEHpP02xzWdIZqRWe_el6tpecT'),  // f9
                driveUrl('1C3nNOKuDTOYP0eEeugZnRJ_K35YNYqik'),  // f10
                driveUrl('1DBxSYWHu8MV9evTIce_IFSEOXFHz4BpH'),  // f11
                driveUrl('1E_NAmloRSBxGnpNfEyjl8lUqXs5DnLA_'),  // f12
                driveUrl('1E_nE0vasp5zZg0vWsui31IQXgPvO0tG6'),  // f13
                driveUrl('1EishJ79WyyL9-Lx_aq2fYyhn9B3gETpJ'),  // f14
                driveUrl('1FAixJbp-0e8r_7fDbFvNjUffVedaG4-r'),  // f15
                driveUrl('1GUPhcuT5XIygUR420S7hamfct_5AcReY'),  // f16
                driveUrl('1Guw7PWhRTGejVFL-_ehXS1JywXqptigd'),  // f17
                driveUrl('1JguMbZXQHB6OMJPGa4KRm7klDh3QySCp'),  // f18
                driveUrl('1LaA6gkcH55XMNFQyNAqWYl7VVmFYklDm'),  // f19
                driveUrl('1M5NdSD_nnDbAnAepuZn__UqawEg8U-YQ'),  // f20
                driveUrl('1NyMfg46qSwCf3QGggcVW-HzIx1_9qJqi'),  // f21
                driveUrl('1O0gDHFQYCocioO8urIowBltgT9Zx2Wzb'),  // f22
                driveUrl('1OV3Z8nkzg1jooR7yyCFR3LlirtjxUfBq'),  // f23
                driveUrl('1On83PLhI1PKQUUNS7MpRv9e0RHIqrWaJ'),  // f24
                driveUrl('1REFc8eWfqY4t7lYZ2dDaHf4aWDxGHOMO'),  // f25
                driveUrl('1Sa3-OiS76s-MCUuOgZ0lZim8FkbGmviP'),  // f26
                driveUrl('1TYKU8xXVapLuKmJDgq9-LpibBo0dowe3'),  // f27
                driveUrl('1UOSZ2CyggX4T6yGsKK6S_Mf3w9O2wEgP'),  // f28
                driveUrl('1X4-saTJM9fMsicGs6O1CEUFtoMYK21uG'),  // f29
                driveUrl('1Y4wSaB5YjRYNPy19vrpJctNJy-7dPl5X'),  // f30
                driveUrl('1Y_UBQEoEq6Rze6hB8nskONjakNZGLWyp'),  // f31
                driveUrl('1YfNn_ACXxb2va0xCKlwsX8KLBGqFqE-w'),  // f32
                driveUrl('1_dj_Mz4wZyuhVGu4ws5a65vohnw1iunw'),  // f33
                driveUrl('1_x0AYbzxOTGcGHa0hd50nwzY-rmi1bjA'),  // f34
                driveUrl('1aJu9XNkU9Mr94GT1qdmX2eFJ_Skl6tJz'),  // f35
                driveUrl('1aXAwnINGl50oIl-laVD0V7rWkHP0udjb'),  // f36
                driveUrl('1c-gvAPn5GTxCfbGA56Kq0s0FpN4ca0rO'),  // f37
                driveUrl('1c5K08tHyIHy0XntwY3qCyVMnL_ynGgOT'),  // f38
                driveUrl('1d4Nuvh3neok3s0bika2EyHAhXBKuLmS_'),  // f39
                driveUrl('1dhIr13LXDDQ5L7iJuHRr1wMn1vkZ7HO0'),  // f40
                driveUrl('1fAsfQX_N72AB3GGPqhBx8QUL-6rnJEV1'),  // f41
                driveUrl('1fEnEfL7W3kItSGY_3iqAYTfPhhk4NX5j'),  // f42
                driveUrl('1gVA3No7f9EkHdSf2XsgaWjm-WFZH5JNz'),  // f43
                driveUrl('1j46br0uKq-gPijAoyGUjpC8m5PZ2fLxX'),  // f44
                driveUrl('1m32TcoAPnBhYiflkYOMzqBaGisRPdymj'),  // f45
                driveUrl('1neNXSjdtQsmK9GM1e_m_jo5MDKslWag_'),  // f46
                driveUrl('1oBMGNJIAOylo9YgPg1zXVO9gIZP6Q5Hp'),  // f47
                driveUrl('1oIQ__zV4IH2plPP6B72VZHIbZTc1F_Fk'),  // f48
                driveUrl('1oVSAnEqoMPUjDcwQEjDeN_isFOu_9nHd'),  // f49
                driveUrl('1oZJ7NcbSP916E8UYafb6lKPwcxy1cw_a'),  // f50
                driveUrl('1owszNiGUlYiOKQnG3gA36Mske3qvoRgn'),  // f51
                driveUrl('1pQ-sWtm6yAlULeyEA3SBPHx8jeGmpvi5'),  // f52
                driveUrl('1qGROb7CfVsyEPxKE7F_pp_aGphzCe4Uw'),  // f53
                driveUrl('1qU_25PaPfNreI40P9h3e6cbbhLTKWetB'),  // f54
                driveUrl('1qhEajzmudP3UojA-ShC596HwMwtWDDSl'),  // f55
                driveUrl('1qkvDDr63t_pYvU8Kbjy0X9PkIOA1RvA2'),  // f56
                driveUrl('1qvXjhsDOwvhuFF6QdcyjeRWE_46aP4L1'),  // f57
                driveUrl('1r_5e97RvGrvhIaXZrIuW3i_cGG-NfdvR'),  // f58
                driveUrl('1raKumnjzTGAH2uIcfyDrh48XphRx7drt'),  // f59
                driveUrl('1s75McCSBn_CuAMBC9zKlCpQSaZImLSzz'),  // f60
                driveUrl('1sStf7Gf5QwV1uayjKat3zD0ARQiS54HW'),  // f61
                driveUrl('1tO35WjMCEkFBquh8VVfmvS21b1T4Gcpz'),  // f62
                driveUrl('1uqHhgIYfuHs1EsuaWE7LYD3ZsXfK0Qlz'),  // f63
                driveUrl('1vDqbXMmieh_DmuoYt1nXSm9YnVDeYsrK'),  // f64
                driveUrl('1xVtmQWCI56qnqGt2E2-_xfD7gzRNrQ-S'),  // f65
            ],

            // Videos REALES (grabaciones reales) - r1 a r65
            reales: [
                driveUrl('10Ax7UrTD3LeodLrsYB_nbQfhwK357tlb'),  // r1
                driveUrl('10LNpQWJvzYppXDx_hbPyDtNP_JqUyF99'),  // r2
                driveUrl('13S1UD9FWtLTs3SgBTHvbOK_kOx8o0ckc'),  // r3
                driveUrl('14fCvNc_Kfm2XzY1dfvH6kztT_LcWLO8W'),  // r4
                driveUrl('155TXZpJ1IIoGx4Yk4t-EIcBCHB2h7pWd'),  // r5
                driveUrl('15MZzL9ruY3TNHlcjVw-i5D6SX2g6uSV-'),  // r6
                driveUrl('15gQwYDgNfEYS13nezFc6ic0uAoRLxTP2'),  // r7
                driveUrl('16U8WgIT_SnlK9ANt_PgWW0uVEGDDWjiy'),  // r8
                driveUrl('17XWBq7aba3tyURU76h7ES9ZPE_lyx-zH'),  // r9
                driveUrl('1A3vkCZB5FckFol84up8LfH1W2svOodVB'),  // r10
                driveUrl('1Ao4b5Z4nvYUBQTOWZGaCAmhcMdCnxVsO'),  // r11
                driveUrl('1Be5L61yNlieua0FQEcG6sr8sCENG_EUh'),  // r12
                driveUrl('1CYgykS7UzL_PobhZHeWMveGt827M_74t'),  // r13
                driveUrl('1DXYNRpQTf7uHVr0EY8t9TcpggimHV3DY'),  // r14
                driveUrl('1FK0-4Fw9fFCZZNre7MOA1hDZD7kh2hgO'),  // r15
                driveUrl('1JWEoEtshMi8YNOeO4I51ami-Mwt_qitZ'),  // r16
                driveUrl('1JXVNFCOSjSbxGsT2AINvHNBi1H0QZyk8'),  // r17
                driveUrl('1JcUfeXIA1xqQ8lVISGd-3zdOZTfVBKF1'),  // r18
                driveUrl('1KWWTPlKwu3DT5Q3k8wB7Y5A-JCaNWO_n'),  // r19
                driveUrl('1NiET61m7bAfAlw6BDYTka48t3HKrzIeT'),  // r20
                driveUrl('1OEeJ7MJqMI0RT7XBQk5DQio7IBsTzLp_'),  // r21
                driveUrl('1Pt_3kqVNN4AvcwkO6w3OEn5GQFGWT6mY'),  // r22
                driveUrl('1PziXNlIloykFqbyHqnMTXnqWcYjkUm4h'),  // r23
                driveUrl('1QIE3yS6_NjcqkutBosVK5buuvdIknD-e'),  // r24
                driveUrl('1QIeVmSZcOD6aCRwV2j-CWrqGB7pSDTeA'),  // r25
                driveUrl('1QsHERXwZrl7FqgM9eIE9Nm7-YxYbrwpU'),  // r26
                driveUrl('1R4OnJX5ANIV5FYtF_6XtxA_iw73mczmP'),  // r27
                driveUrl('1RDYzQn3PNIpzMBqbk4ccjCsYmK20-cDi'),  // r28
                driveUrl('1Sx4kv05VMiqg13B8q6CWYGFlh9jpNmBL'),  // r29
                driveUrl('1TIBo5FdLA1n_EsQcE6hNdSxSlZMhAaCQ'),  // r30
                driveUrl('1T_dvSKa4s8NPdJKisuTuXg0Q42pvqfWE'),  // r31
                driveUrl('1URB-MejTpPFHj1csW33WvFg4_ZQnOquK'),  // r32
                driveUrl('1Ua0MSGP3LBWklpkO9lLAx5fehIGKwS3m'),  // r33
                driveUrl('1X4sZD0p8LvLCLkOHOJeEEAkBF457gA-H'),  // r34
                driveUrl('1XGJRKblnSgAHnPNvQ27LefpvHyWWMBN2'),  // r35
                driveUrl('1XnP0JddADX7QFh_Yqt7UU5DLGN68TYzq'),  // r36
                driveUrl('1YJKIpzbADtBm7hVMvd4CWb-nv-UStdoW'),  // r37
                driveUrl('1YxZVUT_LNC29tVLJP-QwrIX4xzpu5u4y'),  // r38
                driveUrl('1a0aVPMJF0y1QnxOUTc3YgJqpEBw1_CcP'),  // r39
                driveUrl('1aamCgTlnWokusbGIRujWVPqktoG4X7Qi'),  // r40
                driveUrl('1cOCVUkxt3FPF8E_NCTODqwgGBuFPSUzn'),  // r41
                driveUrl('1d-Cc4QdnVX6hzVLshRcLNAwcZDNt-6--'),  // r42
                driveUrl('1dCA7OaEoPjvqnx7u3EsYzpp62gP7BaaE'),  // r43
                driveUrl('1ecaDKUqyicVCHUQFjew8ygHWwuzApZY8'),  // r44
                driveUrl('1euxTqNZkME2dg2RyDoTr6wnS6M9Lxsr5'),  // r45
                driveUrl('1fV5wrrYHXHLheo7pcuXUptcnAQpShrai'),  // r46
                driveUrl('1fx_uN4DAz_pxm61nOghNWHLT7nNLCcgb'),  // r47
                driveUrl('1fxeSqt2aGUikr0rNI5qTcVCq1G8MpupG'),  // r48
                driveUrl('1gn7ygHRXfiGjNMCgrnu0Xm4MqEE6TagN'),  // r49
                driveUrl('1hXgy-dAlyGcbRjoiqSlcz2aReacZPx8H'),  // r50
                driveUrl('1hw-sJ3sSrfcsxXiaOm-Aa37hzfEotrPc'),  // r51
                driveUrl('1iGudVt6yLYmjddPcaO-C6q6XUhRObghJ'),  // r52
                driveUrl('1kCkoQAPUM_fHZByF2FK7hMSsoTj2u8Sg'),  // r53
                driveUrl('1kFtbl5nPqAAnFLBrBZ1sMF58r0ip7sFl'),  // r54
                driveUrl('1kyOyqomJQKecuetWHnoAH4d8cC5Hab_e'),  // r55
                driveUrl('1lr5J0KzYuwQucHZ41gpBXoupsgOtrTzF'),  // r56
                driveUrl('1n6zlTI8tW9HkXVnrG4q0o1ccl7ldVwxt'),  // r57
                driveUrl('1opr-Cf8m_ubTjqFDS1clubUdd6NQkXQg'),  // r58
                driveUrl('1rR9QFYyUcGtWOxVC_wmJnFDKXUuXwFZe'),  // r59
                driveUrl('1rmUCNO4QePVPIuTjM_LRuQ4YnTU_7AA9'),  // r60
                driveUrl('1sR1719XjjMu-gjWYq2pYWUujhv1vD5uU'),  // r61
                driveUrl('1sZ51yrG_EypolzlwG7o8nxuoj4gGq_W1'),  // r62
                driveUrl('1tM-e-A-sS4J84mp7OLU4dSkofo38r3mN'),  // r63
                driveUrl('1udFnHn297jHmv0O_GUYifHUrw6rg2TqG'),  // r64
                driveUrl('1w2RZcNsljIRFSN6A-2Dq1Am79mZfxa9W'),  // r65
            ],

            // Videos PLACEBO (control de atenci√≥n) - p1 a p10
            placebo: [
                driveUrl('12As2Ypo-WiF_PHGzQ7U1S0xpdeKd-Yk9'),  // p1
                driveUrl('16N1grDlSV2I8cABFn1iTbP1nz5Kcdn27'),  // p2
                driveUrl('1IFk7FBPHekNsd-qT0lRwg16h80kAvfJb'),  // p3
                driveUrl('1QCaFdsT6AToEbXTaWAej8QApkemrJKnJ'),  // p4
                driveUrl('1RL4lJPYWLMqcTPleHR-BhwHp2doMpl3w'),  // p5
                driveUrl('1lsovv9l_xFtEyNjCPw8i2ohH-qlZkE4G'),  // p6
                driveUrl('1mLzzaNR-uhShWIE5bspKbiNNiYLs_GRX'),  // p7
                driveUrl('1uU0Uf_wf60MvaD5qaPktlPc_EuzBdBb5'),  // p8
                driveUrl('1upiBwXS3rNOFHRW3ykKYxbC5v11Nb2yL'),  // p9
                driveUrl('1wCOK-esCnDGTxTguXb8T0FOcc7ShicEM'),  // p10
            ]
        };

        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function selectVideosForExperiment() {
            let selected = [];

            // NUEVA L√ìGICA DE SELECCI√ìN:
            // Total: 20 videos
            // - 4 placebos (control de atenci√≥n)
            // - 8 fakes (videos generados por IA)
            // - 8 reales (videos reales)

            // 1. Seleccionar 4 placebos aleatorios (o todos si hay menos de 4)
            const numPlacebos = Math.min(VIDEOS_POOL.placebo.length, 4);
            const selectedPlacebos = shuffleArray(VIDEOS_POOL.placebo).slice(0, numPlacebos);
            selected.push(...selectedPlacebos.map(path => ({
                path,
                tipo: 'placebo',
                es_fake: true, // Los placebos son videos evidentemente fake (para control de atenci√≥n)
                es_placebo: true
            })));

            // 2. Seleccionar 8 fakes aleatorios
            const selectedFakes = shuffleArray(VIDEOS_POOL.fakes).slice(0, 8);
            selected.push(...selectedFakes.map(path => ({
                path,
                tipo: 'fake',
                es_fake: true,
                es_placebo: false
            })));

            // 3. Seleccionar 8 reales aleatorios
            const selectedReales = shuffleArray(VIDEOS_POOL.reales).slice(0, 8);
            selected.push(...selectedReales.map(path => ({
                path,
                tipo: 'real',
                es_fake: false,
                es_placebo: false
            })));

            // Total: 4 + 8 + 8 = 20 videos
            // Mezclar el orden final
            return shuffleArray(selected);
        }

</script>
</body>
</html>
