<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experimento: Detecci√≥n de Videos Generados por IA</title>
    <style>
        /* Variables CSS */
        :root {
            --primary-color: #1a5490;
            --secondary-color: #2c7ab5;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --text-dark: #2c3e50;
            --bg-light: #ecf0f1;
            --bg-white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            color: var(--text-dark);
            background-color: var(--bg-light);
        }

        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        header h1 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 1.6rem;
            font-weight: 600;
        }

        header .subtitle {
            margin: 0;
            font-size: 1rem;
            opacity: 0.9;
            font-style: italic;
        }

        header .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .experiment-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0.5rem;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin: 0.5rem auto;
            background-color: #000;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .video-container iframe {
            width: 100%;
            height: 400px;
            display: block;
            border: none;
        }

        .slider-container {
            margin: 0.5rem 0;
            padding: 0.75rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 4px;
        }

        .slider-container h3 {
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .label-real {
            color: var(--success-color);
        }

        .label-fake {
            color: var(--danger-color);
        }

        .slider-track {
            position: relative;
            height: 50px;
            margin: 0.5rem 0;
        }

        .slider-input {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right,
                #27ae60 0%, #27ae60 20%,
                #95a5a6 50%,
                #e74c3c 80%, #e74c3c 100%);
            outline: none;
            -webkit-appearance: none;
            margin: 20px 0;
        }

        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-color);
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .slider-input::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 14px rgba(0,0,0,0.4);
        }

        .slider-input::-moz-range-thumb {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-color);
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .slider-value-display {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            margin: 0.25rem 0;
            color: var(--primary-color);
        }

        .slider-markers {
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            margin-top: -10px;
        }

        .marker {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-light);
        }

        .progress-info {
            text-align: center;
            padding: 0.4rem;
            background-color: #e3f2fd;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .progress-info h3 {
            margin: 0;
            color: var(--primary-color);
            font-size: 0.85rem;
        }

        .progress-bar-container {
            width: 100%;
            height: 25px;
            background-color: var(--bg-light);
            border-radius: 12px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--success-color) 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .btn-next {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-next:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .form-group {
            margin-bottom: 0.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .form-group select,
        .form-group input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .instructions-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .instructions-box h3 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .instructions-box ul {
            margin-left: 1.5rem;
        }

        .instructions-box li {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .thank-you-message {
            text-align: center;
            padding: 3rem;
        }

        .thank-you-message h2 {
            color: var(--success-color);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .consent-box {
            background-color: white;
            border: 2px solid var(--border-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .consent-box label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .consent-box input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 1rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Experimento: Detecci√≥n de Videos Generados por IA</h1>
            <p class="subtitle">Universidad - Estudio sobre percepci√≥n de contenido sint√©tico</p>
        </div>
    </header>

    <main class="container experiment-container">
        <!-- PASO 1: Introducci√≥n y consentimiento -->
        <div id="step-intro" class="step active">
            <div class="section">
                <div style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); padding: 1.5rem; border-radius: 8px; color: white; text-align: center; margin-bottom: 1.5rem;">
                    <h2 style="margin: 0; font-size: 1.8rem;">üé¨ Experimento de Detecci√≥n de Videos IA</h2>
                </div>

                <div class="instructions-box">
                    <h3 style="text-align: center;">üìã Informaci√≥n sobre el Estudio</h3>
                    <p><strong>Investigador Principal:</strong> Silvia Charles Roland (scrolland@hotmail.com)</p>
                    <p><strong>N√∫mero de videos a evaluar:</strong> 20 videos</p>
                    <p><strong>Duraci√≥n estimada:</strong> 10-15 minutos</p>

                    <h4>Objetivo del Estudio:</h4>
                    <p>Este experimento busca entender c√≥mo las personas perciben y distinguen entre videos reales y videos generados por inteligencia artificial.</p>

                    <h4>Tem√°tica de los Videos:</h4>
                    <p>Los videos que ver√°s muestran <strong>situaciones tur√≠sticas</strong>: paisajes, monumentos, personas en entornos vacacionales, escenas de viajes, etc. Ver√°s tanto contenido de entretenimiento como informativo relacionado con destinos y experiencias tur√≠sticas.</p>

                    <h4>¬øQu√© tendr√°s que hacer?</h4>
                    <ul>
                        <li><strong>Ver√°s 20 videos</strong> cortos (cada uno dura entre 5-10 segundos)</li>
                        <li>Para cada video, deber√°s <strong>indicar si crees que es REAL o FAKE (generado por IA)</strong></li>
                        <li>Si consideras que el video es <strong>FAKE</strong>, te pediremos que valores 3 aspectos usando sliders del 0 al 10:
                            <ul>
                                <li><strong>Coherencia de elementos visuales en primer plano</strong></li>
                                <li><strong>Naturalidad del movimiento</strong></li>
                                <li><strong>Coherencia de iluminaci√≥n y sombras</strong></li>
                            </ul>
                            <small>(0 = Muy mal / Muy artificial | 10 = Perfecto / Muy natural)</small>
                        </li>
                        <li>No hay respuestas correctas o incorrectas, queremos tu <strong>percepci√≥n honesta</strong></li>
                    </ul>

                    <h4>Uso de los Datos:</h4>
                    <p>Tus respuestas ser√°n completamente <strong>an√≥nimas</strong> y se utilizar√°n √∫nicamente con fines de investigaci√≥n acad√©mica. Los datos se almacenar√°n de forma segura y no se compartir√°n identificadores personales.</p>
                </div>

                <div class="consent-box">
                    <label>
                        <input type="checkbox" id="consent-check" required>
                        <span>He le√≠do la informaci√≥n del estudio y acepto participar voluntariamente. Entiendo que puedo abandonar el experimento en cualquier momento.</span>
                    </label>
                </div>

                <h3>Datos Demogr√°ficos</h3>
                <div class="form-group">
                    <label for="genero">G√©nero *</label>
                    <select id="genero" required>
                        <option value="">Selecciona...</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Femenino">Femenino</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="edad">Edad *</label>
                    <input type="number" id="edad" min="18" max="99" required placeholder="Ej: 25">
                </div>

                <div class="form-group">
                    <label for="consumo-videos">Nivel de consumo habitual de videos *</label>
                    <select id="consumo-videos" required>
                        <option value="">Selecciona...</option>
                        <option value="Muy poco/nada">Muy poco/nada</option>
                        <option value="Habitualmente/Muy habitualmente">Habitualmente/Muy habitualmente</option>
                    </select>
                </div>

                <button class="btn-next" onclick="startExperiment()">Comenzar Experimento</button>
            </div>
        </div>

        <!-- PASO 2: Videos -->
        <div id="step-videos" class="step">
            <div class="progress-info">
                <h3>Video <span id="current-video">1</span> de 20</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-bar" style="width: 5%;">5%</div>
                </div>
            </div>

            <div class="video-container">
                <iframe id="video-player" src="" allow="autoplay"></iframe>
            </div>

            <!-- Pregunta principal: Real o Fake -->
            <div class="slider-container">
                <h3>¬øEste video es real o generado por IA?</h3>
                <div style="display: flex; justify-content: center; gap: 2rem; margin: 1rem 0;">
                    <label style="display: flex; align-items: center; padding: 1rem 2rem; background: #f8f9fa; border-radius: 8px; cursor: pointer; border: 3px solid transparent; transition: all 0.2s;" id="label-real">
                        <input type="radio" name="respuesta-tipo" value="real" style="margin-right: 0.75rem; width: 22px; height: 22px; cursor: pointer;" onchange="onTipoChange('real')">
                        <span style="font-size: 1.1rem; font-weight: 600; color: var(--success-color);">REAL</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 1rem 2rem; background: #f8f9fa; border-radius: 8px; cursor: pointer; border: 3px solid transparent; transition: all 0.2s;" id="label-fake">
                        <input type="radio" name="respuesta-tipo" value="fake" style="margin-right: 0.75rem; width: 22px; height: 22px; cursor: pointer;" onchange="onTipoChange('fake')">
                        <span style="font-size: 1.1rem; font-weight: 600; color: var(--danger-color);">FAKE (IA)</span>
                    </label>
                </div>
            </div>

            <!-- Sliders condicionales (solo si elige FAKE) -->
            <div id="sliders-fake-container" class="slider-container" style="display: none;">
                <h3 style="margin-bottom: 1rem;">Valora los siguientes aspectos del video:</h3>
                <p style="text-align: center; color: var(--text-light); margin-bottom: 1rem;">
                    <small>0 = Muy mal / Muy artificial | 10 = Perfecto / Muy natural</small>
                </p>

                <!-- Slider 1: Coherencia elementos visuales -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Coherencia de los elementos visuales en primer plano</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 0.8rem; color: var(--danger-color);">0</span>
                        <input type="range" id="slider-coherencia" class="slider-input" min="0" max="10" value="5" oninput="updateSliderDisplay('coherencia', this.value)" style="flex: 1;">
                        <span style="font-size: 0.8rem; color: var(--success-color);">10</span>
                        <span id="value-coherencia" style="font-weight: bold; min-width: 30px; text-align: center;">5</span>
                    </div>
                </div>

                <!-- Slider 2: Naturalidad movimiento -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Naturalidad del movimiento observado en el video</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 0.8rem; color: var(--danger-color);">0</span>
                        <input type="range" id="slider-movimiento" class="slider-input" min="0" max="10" value="5" oninput="updateSliderDisplay('movimiento', this.value)" style="flex: 1;">
                        <span style="font-size: 0.8rem; color: var(--success-color);">10</span>
                        <span id="value-movimiento" style="font-weight: bold; min-width: 30px; text-align: center;">5</span>
                    </div>
                </div>

                <!-- Slider 3: Coherencia iluminacion -->
                <div style="margin-bottom: 0.5rem;">
                    <label style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Coherencia de la iluminacion y las sombras del video</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 0.8rem; color: var(--danger-color);">0</span>
                        <input type="range" id="slider-iluminacion" class="slider-input" min="0" max="10" value="5" oninput="updateSliderDisplay('iluminacion', this.value)" style="flex: 1;">
                        <span style="font-size: 0.8rem; color: var(--success-color);">10</span>
                        <span id="value-iluminacion" style="font-weight: bold; min-width: 30px; text-align: center;">5</span>
                    </div>
                </div>
            </div>

            <button class="btn-next" onclick="nextVideo()">Siguiente Video ‚Üí</button>
        </div>

        <!-- PASO 3: Finalizaci√≥n -->
        <div id="step-thanks" class="step">
            <div class="section thank-you-message" style="text-align: center;">
                <div style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); padding: 2rem; border-radius: 12px; color: white; margin: 1rem 0;">
                    <h2 style="font-size: 2rem; margin-bottom: 1rem;">¬°Experimento Completado!</h2>
                    <p style="font-size: 1.1rem; margin: 0;">
                        Tus respuestas han sido guardadas exitosamente
                    </p>
                </div>

                <!-- Resultados del participante -->
                <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border-left: 4px solid #ff9800;">
                    <h3 style="color: #e65100; text-align: center; margin-bottom: 1rem;">Tus Resultados</h3>
                    <p style="font-size: 1.5rem; font-weight: bold; text-align: center; margin: 0.5rem 0;">
                        Aciertos: <span id="resultado-aciertos" style="color: var(--success-color);">0</span> / <span id="resultado-total">20</span>
                    </p>
                    <p style="font-size: 1.2rem; text-align: center; color: #666;">
                        (<span id="resultado-porcentaje">0</span>% de acierto)
                    </p>
                </div>

                <!-- Videos fallados -->
                <div id="videos-fallados-container" style="background: #fff; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border: 2px solid #e0e0e0; text-align: left; display: none;">
                    <h3 style="color: var(--danger-color); text-align: center; margin-bottom: 1rem;">Videos en los que fallaste</h3>
                    <div id="lista-videos-fallados" style="max-height: 300px; overflow-y: auto;">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; text-align: left;">
                    <h3 style="color: var(--primary-color); text-align: center; margin-bottom: 1rem;">Sobre el Estudio</h3>
                    <p style="margin: 0.5rem 0;">Los videos inclu√≠an grabaciones reales y contenido generado por IA con diferentes niveles de calidad.</p>
                    <p style="margin: 0.5rem 0;"><strong>Objetivo:</strong> Investigar c√≥mo las personas detectan contenido sint√©tico y qu√© caracter√≠sticas visuales despiertan sospechas.</p>
                </div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                    <p style="margin: 0; font-size: 0.95rem;">
                        <strong>Investigador Principal:</strong> Silvia Charles Roland<br>
                        <strong>Universidad:</strong> Universitat de les Illes Balears<br>
                        <strong>Contacto:</strong> <a href="mailto:scrolland@hotmail.com">scrolland@hotmail.com</a>
                    </p>
                </div>

                <p style="margin-top: 2rem; font-size: 1.1rem; color: var(--success-color); font-weight: 600;">
                    ¬°Gracias por contribuir a esta investigacion!
                </p>
            </div>
        </div>
    </main>

    <script>
        // State management
        let experimentState = {
            participanteId: null,
            currentVideo: 0,
            videos: [],
            responses: [],
            startTime: null,
            videoStartTime: null,
            isSubmitting: false
        };

        // Funci√≥n para manejar cambio de tipo (Real/Fake)
        function onTipoChange(tipo) {
            const slidersFakeContainer = document.getElementById('sliders-fake-container');
            const labelReal = document.getElementById('label-real');
            const labelFake = document.getElementById('label-fake');

            // Resetear estilos
            labelReal.style.border = '3px solid transparent';
            labelFake.style.border = '3px solid transparent';

            if (tipo === 'fake') {
                slidersFakeContainer.style.display = 'block';
                labelFake.style.border = '3px solid var(--danger-color)';
                labelFake.style.background = '#ffebee';
            } else {
                slidersFakeContainer.style.display = 'none';
                labelReal.style.border = '3px solid var(--success-color)';
                labelReal.style.background = '#e8f5e9';
            }
        }

        // Funci√≥n para actualizar display de sliders
        function updateSliderDisplay(tipo, value) {
            document.getElementById('value-' + tipo).textContent = value;
        }

        // Start experiment
        async function startExperiment() {
            // Validate inputs
            const consent = document.getElementById('consent-check').checked;
            const genero = document.getElementById('genero').value;
            const edad = document.getElementById('edad').value;
            const consumoVideos = document.getElementById('consumo-videos').value;

            if (!consent) {
                alert('Debes aceptar el consentimiento informado para continuar.');
                return;
            }

            if (!genero || !edad || !consumoVideos) {
                alert('Por favor completa todos los campos demogr√°ficos.');
                return;
            }

            if (edad < 18) {
                alert('Debes ser mayor de 18 a√±os para participar en este experimento.');
                return;
            }

            // Initialize experiment
            experimentState.participanteId = 'P' + Date.now();
            experimentState.genero = genero;
            experimentState.edad = parseInt(edad);
            experimentState.consumoVideos = consumoVideos;
            experimentState.videos = selectVideosForExperiment();
            experimentState.startTime = Date.now();

            // Show videos step
            document.getElementById('step-intro').classList.remove('active');
            document.getElementById('step-videos').classList.add('active');

            // Load first video
            loadVideo(0);
        }

        // Load video
        function loadVideo(index) {
            if (index >= experimentState.videos.length) {
                finishExperiment();
                return;
            }

            experimentState.currentVideo = index;
            experimentState.videoStartTime = Date.now();

            const video = experimentState.videos[index];
            const videoPlayer = document.getElementById('video-player');
            videoPlayer.src = video.path;

            // Reset radio buttons Real/Fake
            const radios = document.querySelectorAll('input[name="respuesta-tipo"]');
            radios.forEach(radio => radio.checked = false);

            // Reset estilos de labels
            const labelReal = document.getElementById('label-real');
            const labelFake = document.getElementById('label-fake');
            labelReal.style.border = '3px solid transparent';
            labelReal.style.background = '#f8f9fa';
            labelFake.style.border = '3px solid transparent';
            labelFake.style.background = '#f8f9fa';

            // Ocultar sliders condicionales
            document.getElementById('sliders-fake-container').style.display = 'none';

            // Reset sliders a valor 5
            document.getElementById('slider-coherencia').value = 5;
            document.getElementById('slider-movimiento').value = 5;
            document.getElementById('slider-iluminacion').value = 5;
            document.getElementById('value-coherencia').textContent = '5';
            document.getElementById('value-movimiento').textContent = '5';
            document.getElementById('value-iluminacion').textContent = '5';

            // Update progress
            const progress = ((index + 1) / experimentState.videos.length) * 100;
            document.getElementById('current-video').textContent = index + 1;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-bar').textContent = Math.round(progress) + '%';
        }

        // Next video
        async function nextVideo() {
            const respuestaTipoRadio = document.querySelector('input[name="respuesta-tipo"]:checked');
            const timeSpent = Math.round((Date.now() - experimentState.videoStartTime) / 1000);

            // Validar que haya seleccionado Real o Fake
            if (!respuestaTipoRadio) {
                alert('Por favor, indica si el video es REAL o FAKE.');
                return;
            }

            const respuestaTipo = respuestaTipoRadio.value; // 'real' o 'fake'
            const currentVideo = experimentState.videos[experimentState.currentVideo];

            // Obtener valores de sliders (solo relevantes si eligi√≥ fake)
            let sliderCoherencia = null;
            let sliderMovimiento = null;
            let sliderIluminacion = null;

            if (respuestaTipo === 'fake') {
                sliderCoherencia = parseInt(document.getElementById('slider-coherencia').value);
                sliderMovimiento = parseInt(document.getElementById('slider-movimiento').value);
                sliderIluminacion = parseInt(document.getElementById('slider-iluminacion').value);
            }

            // Determinar si acert√≥
            const esRealElVideo = !currentVideo.es_fake;
            const usuarioDijoReal = respuestaTipo === 'real';
            const acierto = esRealElVideo === usuarioDijoReal;

            // Save response with all fields
            const response = {
                numero: experimentState.currentVideo + 1,
                path: currentVideo.path,
                tipo_contenido: currentVideo.tipo,
                es_fake_real: currentVideo.es_fake,
                evidente: currentVideo.es_evidente || false,
                calidad: currentVideo.quality || currentVideo.calidad || 'desconocida',
                respuesta_usuario: respuestaTipo,
                acierto: acierto,
                slider_coherencia: sliderCoherencia,
                slider_movimiento: sliderMovimiento,
                slider_iluminacion: sliderIluminacion,
                tiempo: Math.round(timeSpent),
                es_placebo: currentVideo.es_evidente || false
            };

            experimentState.responses.push(response);

            // Load next video or finish
            loadVideo(experimentState.currentVideo + 1);
        }

        // Finish experiment
        async function finishExperiment() {
            // Prevenir env√≠os m√∫ltiples
            if (experimentState.isSubmitting) {
                console.log('Ya se est√° enviando, ignorando llamada duplicada');
                return;
            }

            experimentState.isSubmitting = true;

            // Calcular resultados
            const totalVideos = experimentState.responses.length;
            const aciertos = experimentState.responses.filter(r => r.acierto).length;
            const porcentaje = Math.round((aciertos / totalVideos) * 100);
            const videosFallados = experimentState.responses.filter(r => !r.acierto);

            const data = {
                participante_id: experimentState.participanteId,
                genero: experimentState.genero,
                edad: experimentState.edad,
                consumo_videos: experimentState.consumoVideos,
                fecha_inicio: new Date(experimentState.startTime).toISOString(),
                fecha_finalizacion: new Date().toISOString(),
                total_aciertos: aciertos,
                total_videos: totalVideos,
                porcentaje_acierto: porcentaje,
                respuestas: experimentState.responses
            };

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                // Mostrar resultados
                mostrarResultados(aciertos, totalVideos, porcentaje, videosFallados);

                document.getElementById('step-videos').classList.remove('active');
                document.getElementById('step-thanks').classList.add('active');

            } catch (error) {
                console.error('Error:', error);
                mostrarResultados(aciertos, totalVideos, porcentaje, videosFallados);
                document.getElementById('step-videos').classList.remove('active');
                document.getElementById('step-thanks').classList.add('active');
            }
        }

        // Mostrar resultados en pantalla final
        function mostrarResultados(aciertos, total, porcentaje, videosFallados) {
            document.getElementById('resultado-aciertos').textContent = aciertos;
            document.getElementById('resultado-total').textContent = total;
            document.getElementById('resultado-porcentaje').textContent = porcentaje;

            // Si hay videos fallados, mostrar la lista
            if (videosFallados.length > 0) {
                const container = document.getElementById('videos-fallados-container');
                const lista = document.getElementById('lista-videos-fallados');
                container.style.display = 'block';

                let html = '';
                videosFallados.forEach((video, index) => {
                    const realOFake = video.es_fake_real ? 'FAKE (IA)' : 'REAL';
                    const colorRespuesta = video.es_fake_real ? 'var(--danger-color)' : 'var(--success-color)';
                    const tuRespuesta = video.respuesta_usuario === 'real' ? 'REAL' : 'FAKE';

                    html += `
                        <div style="padding: 0.75rem; margin-bottom: 0.5rem; background: #f8f9fa; border-radius: 6px; border-left: 4px solid ${colorRespuesta};">
                            <p style="margin: 0; font-weight: 600;">Video ${video.numero}</p>
                            <p style="margin: 0.25rem 0; font-size: 0.9rem;">
                                Tu respuesta: <strong>${tuRespuesta}</strong> |
                                Correcto: <strong style="color: ${colorRespuesta};">${realOFake}</strong>
                            </p>
                        </div>
                    `;
                });

                lista.innerHTML = html;
            }
        }

        // CONFIGURACI√ìN GOOGLE SHEETS
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzwJskx0d2S5frpxSa7Tzap9We1UwdU8qvfXu2Ha-Nol6wCk9M_SIPL7aUQmlgoHn77/exec';

        // Configuraci√≥n de videos
        // Helper function para crear URL de Google Drive con autoplay
        const driveUrl = (id) => `https://drive.google.com/file/d/${id}/preview`;

        // NUEVA ESTRUCTURA: 3 carpetas (fakes, reales, placebo)
        // Carpeta: https://drive.google.com/drive/u/2/folders/1iwUNV-Z2t6GViM4FDRI0TbKpeTdACH5b
        const VIDEOS_POOL = {
            // Videos FAKE (generados por IA) - f1 a f65
            fakes: [
                driveUrl('1INQbE3mIpNjr7uyQw5cSBKToYNY6fByy'),  // f1
                driveUrl('1ofPl4YSAbx7x6BQWTnUNeFxo2YQ_9uJJ'),  // f2
                driveUrl('1W7QmV-H_JXGv58MXpt97Kw6EI01O_qYu'),  // f3
                driveUrl('15RYcacFvH9nNSQhKE7GrN3Rvk4U_1sNw'),  // f4
                driveUrl('1g0N1panwombofVKw4oGu5kVR1hz8yX6h'),  // f5
                driveUrl('1LeJAviR2U9PYoCShEmD2zcOUbY-k9irs'),  // f6
                driveUrl('1ue6w8rJt3Ebb7Rpol0fhHB_mkwCeQADT'),  // f7
                driveUrl('1hKurYxAW6HE0HtUaWpQNwhC0kSOVOl8h'),  // f8
                driveUrl('1K3sZT02g24zTkpg6f3-8dIYB1OCoCyHi'),  // f9
                driveUrl('1i6RbwGlRtSjaUEBIAbRuOaZbad9HRihC'),  // f10
                driveUrl('1KBMqxUqwSwQkTE-FHxaR8s24-XYD2L2c'),  // f11
                driveUrl('19jbt6vHVAJEV7gbtT7h5pdvdRLHvCwyi'),  // f12
                driveUrl('1AfV310GbFub2ZP7Cb5qnyXxnWNe19UxT'),  // f13
                driveUrl('1I-V_3UjdXmNWlrmykXmlUS8_e5jJx1us'),  // f14
                driveUrl('15PEY9gJ-7Z3whM8-FLnJwJ2ihiOJhLKN'),  // f15
                driveUrl('1qUDZwTnyA3gRszsDJ06NNWQmodtHXcPY'),  // f16
                driveUrl('1q_VlI2f8XqDsAoXvzabNMBoalJvPWOOr'),  // f17
                driveUrl('1b-245BmpxUv22bozPqTFjQFhn5l0Oq53'),  // f18
                driveUrl('11vkA8cMfl_gNbXXEf8_fDLoacqdxoKc5'),  // f19
                driveUrl('1NPdGIEt4c7nKVBo53bL5tCPhmwzUYkuY'),  // f20
                driveUrl('1FwFNwmsnf6dw_usurfC6Am1aGsuo8xAp'),  // f21
                driveUrl('1-hCTkHRaiIXf9VqjzVlReymLzKiW3bMz'),  // f22
                driveUrl('1VRzCyKkkNmiwCkI69ztnnz3Vfhn6SV7a'),  // f23
                driveUrl('1qcVVRp-15SHc8ZrRRz29tHawnK8N90UJ'),  // f24
                driveUrl('1wDi3U_tRJ1_LSIxdA3CQbp4b44cAkojR'),  // f25
                driveUrl('1o0vrPfA4c2e4k4ArC3hO6pwMPJEAAvYp'),  // f26
                driveUrl('1US86_OCvEB7c8tIFkOrH0ECU7M3Dr332'),  // f27
                driveUrl('11RBlJEPfXvTbzDH4mseA5qn51CgVCO6a'),  // f28
                driveUrl('1mbr04BCEyc0dwIrgpaRHqeFHiJl65MDc'),  // f29
                driveUrl('1jRuA7wYl5uWhU6K3sW-zCkPtDu2Ue1bp'),  // f30
                driveUrl('108G9dTuJchCUjNLvA9tQGh2hm6mx8-dF'),  // f31
                driveUrl('1p8Ehd6-Jn5X_uYS822kWi7I657q3_AJw'),  // f32
                driveUrl('1nUftpKN3nb9wZZ88vRILwbFzFGXH4ZLT'),  // f33
                driveUrl('1TOX_HgK7CvV40K8WjaMvSOx48R-d5dfE'),  // f34
                driveUrl('1Xv2OaPZeWh-eJS-L21y7P8Y2YXpqYIn4'),  // f35
                driveUrl('1UBO30GH3CnEwOj_fsx2QPIrWcrCmUl6Y'),  // f36
                driveUrl('1ozzzJ4SpnXe5IW5pUtSBIY9_Qvwo6wFR'),  // f37
                driveUrl('1ueyJOa2ScfpFuClTAk0azNTEzkZL7dKg'),  // f38
                driveUrl('1GR0UcLvJayyFChD_6xZ5xTac3_dnh5oA'),  // f39
                driveUrl('1Apcd-y4dfm7Xk6oX-I-jHL9Hx_TZBerv'),  // f40
                driveUrl('1FYv26NyxNrf4C0WaULDUgmyPiFodHnhv'),  // f41
                driveUrl('1wTyL4y5aFwAbAFgFKXHHwJKULPUmk20T'),  // f42
                driveUrl('1GZfyCtR1uXs2z9W9NQDbZNq0hy-hzQCl'),  // f43
                driveUrl('12c4X84tC4CbxjLDCLvF79OJ43qCeyD73'),  // f44
                driveUrl('1bAM_B62qc5Gcbw-WugKvRFoiBtBnNUao'),  // f45
                driveUrl('1sYQE7KEaFd-jZOsJoXqkEK-UabGu5ObM'),  // f46
                driveUrl('1ecPAPgj_XESvUgvVGvVMkB2sMDx6zaLW'),  // f47
                driveUrl('1BoRaX29uXYzT6wvymEdDdioyzO99083D'),  // f48
                driveUrl('1nrjVGsAXBh00S32bDVuYTZCE-HrKGWDS'),  // f49
                driveUrl('11TJZrIZRZwKct3yt4kL_3IcgsP8VmzxV'),  // f50
                driveUrl('1d1j6qltwadblpK1G612jextgGZ_hRNWK'),  // f51
                driveUrl('1VQfufzjN_W1CiSmTTRkTRpyouc2yUrga'),  // f52
                driveUrl('1hsRgDc5lQQ_jp2i2Hv5Y9xGafToRGoKQ'),  // f53
                driveUrl('1xtll6LiA_vpjmxDrDcLdhiQ29kDGiirF'),  // f54
                driveUrl('1Tpt7DfdJdm7xoz_qnMGomX1t_kp6yOcQ'),  // f55
                driveUrl('1pqYk95V3w4PuVyfttW7EsdDR0j0dCrr2'),  // f56
                driveUrl('14n42ohNszIxQCfulzOu-1qIUsswSKs8P'),  // f57
                driveUrl('1IN8O3B574DrgNyReLewFGTJ68IYCl_S7'),  // f58
                driveUrl('18hSvQSiYacwUmVj7eDYPk1wn7j4Ni8SO'),  // f59
                driveUrl('1Iq29dSfUoxFWlp_kgsutBocfN8gGBVg9'),  // f60
                driveUrl('1OTORIqj3IDjl9fO50YeaEYIlrWWU-xXv'),  // f61
                driveUrl('1NV4eJX5lQSmV-RPHhT5DlgI7wh51lPV5'),  // f62
                driveUrl('1pPqhwF28cItrhlKzMqkmMzU6wCMZ4uYW'),  // f63
                driveUrl('1UDvOXn7yf5O86Ogb1oj7PJ6oPpp4GU96'),  // f64
                driveUrl('1v_NtWczzyBo4EZGqdCLxXyttf0wjz8X0')   // f65
            ],

            // Videos REALES (grabaciones reales) - r1 a r65
            reales: [
                driveUrl('1QwMXFa3BUV_PSZ5W9VAJ4Z2SEy7F_mI2'),  // r1
                driveUrl('1QXAW8hBGhxBvoG_cWR2t05QUaaIn91Jo'),  // r2
                driveUrl('1oacD31ujcV7W0tEAVRtng6FTYyvgmGa0'),  // r3
                driveUrl('1NoX-A6mw26OBg1yoen0tVWGQk9a-zas8'),  // r4
                driveUrl('15FT8WuDG81Fo13A4ELv2K6-Ak77JiBt8'),  // r5
                driveUrl('1xHzjpw2kU6gePC3ZEuKzh5xtqu8VsAS0'),  // r6
                driveUrl('1dScPoJwvwCs4NDok8I1jaNHXXc53dktQ'),  // r7
                driveUrl('1pDe-c77ainx4-Qd6hyaIO1Rya0fJe4T6'),  // r8
                driveUrl('1AjLFYUNQt-DEYUD2FoqCAKTwCWiaDZFd'),  // r9
                driveUrl('1MxoSl3z9RdiL9hBGYwDohKEu50voaSqG'),  // r10
                driveUrl('10gP8DTecRTKwC4WBbfIzQX9HqwbRg9NO'),  // r11
                driveUrl('1-VHp-iQwGGdIQbPCzUxBaixAogIQsai3'),  // r12
                driveUrl('1MAZSNtXou7cJHqmkm33Z7XrUM5AF4HF2'),  // r13
                driveUrl('1BxxNKkaCDkPY0pvsNd94NEKMeVC24yxW'),  // r14
                driveUrl('140Ef7lsG2AvV39slNzHFQspnY1Z72c6G'),  // r15
                driveUrl('1zCTD9Rr3PCyu91aEF5sLyrPXZMnw5dQ-'),  // r16
                driveUrl('1OgIm31JmwWKpyc40Qo093EkjrO5mfRfm'),  // r17
                driveUrl('1fZ7dNsFXSa4mhEv1TMMXda20YbQ7S1JX'),  // r18
                driveUrl('1OKpv79yoRvMApnPU82DVjYQpcfU-MCjg'),  // r19
                driveUrl('1hRA8unzqupEG2axPTe9IktBxHsN7_SO-'),  // r20
                driveUrl('1AmdjEhNgVYI4keu2_mBm8mMCL5cUzsoA'),  // r21
                driveUrl('1zI8_mPXixO9w8nqi0HKjdB_TWllAa3kM'),  // r22
                driveUrl('1xrPOfmJODiOVN-3Ebe0ruY2ZIOWVHq9P'),  // r23
                driveUrl('13zu-KRkcJcJi0Oxz2IGxQMu_LnplDgRN'),  // r24
                driveUrl('1fkB1RsB_9GDZzh-scYLS6UnIbtMaJj6y'),  // r25
                driveUrl('1VHCB-W-hjUNvYgtdfSmljdHqTHEp-uj3'),  // r26
                driveUrl('1p6Nh8EIDcSRHeDm4E9pzVYKsjks46Xn6'),  // r27
                driveUrl('1rvA9-oqjf2Gx9t2nctrhPz9LxlUJ9DEo'),  // r28
                driveUrl('1vZG1gbHsC1DB5YR8t9CFljqu1Yre0_m-'),  // r29
                driveUrl('142awY3gwm9ndLl9s9YRG-fPT85Oj7kPF'),  // r30
                driveUrl('1xA4_whZETaOvX9iQDHT0OhsXGb09yEiS'),  // r31
                driveUrl('1idJ3Rx1cGhUqy8SG-IRLCAKwZ4k8vHVS'),  // r32
                driveUrl('1CMewCdURvji7DUY1mZBH9aCNpB01koxy'),  // r33
                driveUrl('1T8D7vtC9N7SGfoyzMRysmg8uKsC8En6U'),  // r34
                driveUrl('1LKZL8ETqPgZ7FhEk5sj-pr6xrYqqqpgi'),  // r35
                driveUrl('1w-tOe3ATBRWkUKUiOPVmlbnc8RH-RXrZ'),  // r36
                driveUrl('1IFi2rfytDeVzxmSki0SOX-Vx6UjUYMAj'),  // r37
                driveUrl('1C36LEnvgKGY6ZSpVLQ9Q7t2DVv98s1uI'),  // r38
                driveUrl('10RDESg3Rt702W4axWT6LAH00pp9vBTmx'),  // r39
                driveUrl('1VE2Dfj5WuYVGmS7Y-9NHAcgP8VHhChY0'),  // r40
                driveUrl('1ahbJToPIHODukffeDLFiAOWhCkGxx9lh'),  // r41
                driveUrl('1fzvfPANxY9hBTUNgjh57-I0hE2hU6Dnk'),  // r42
                driveUrl('1OAwICoL_o6a9uiaKaH3qI0_HVmds9wzK'),  // r43
                driveUrl('1UOPo-QqDY2M0doiZjXUsYgpec2kAiPSm'),  // r44
                driveUrl('161WuvRGjonpYnQWstYw_4g0DwIs3DDEM'),  // r45
                driveUrl('1DR_5tboaSkfdPurdZCJwbFMCwp25ZJ6h'),  // r46
                driveUrl('1C-1p3y7lBsZwAzI9jYYAiZDjo82pl-tM'),  // r47
                driveUrl('18cGic3llUmArk-m3G0Ln7d8NXu0dLFLd'),  // r48
                driveUrl('16ji_2kdqFoi_s0VLEECQiOxnXUt_45KR'),  // r49
                driveUrl('1f6Bc73Smn2bNItgo3ChZ3ixoiiv10aMl'),  // r50
                driveUrl('1qdGfcduVAHvvMiPWb9oIi5amlnnSnMha'),  // r51
                driveUrl('1Su1qcg6weYnvGW52fbpQEIGam0mdD_UV'),  // r52
                driveUrl('13863pWgJjTixy51bGHv4rj81yArDoc2I'),  // r53
                driveUrl('1ePRezD6Nwsn6fibySzMCppbmcSqQbL_k'),  // r54
                driveUrl('1qOvzeGvuILhOLbQHDlMYrGoYHo3VhwFW'),  // r55
                driveUrl('1ml3lhfT4GmKNrKwA-kxRFd9jDHQw08SQ'),  // r56
                driveUrl('1gUh5WsT07tXom1iGisYfb-HJ36l3bN3x'),  // r57
                driveUrl('14yky8wE57ehye24YkO6NkqzSfztOJKXo'),  // r58
                driveUrl('1mWfaLSZSFVt8YzCCo2WXL_SWNp0mj6y1'),  // r59
                driveUrl('1TZkeGW-Q1xutlT7IeegJnDFrz_ZyorFl'),  // r60
                driveUrl('1QtIoUeCC9od_jPW3m0YQqFh_6R2K_scG'),  // r61
                driveUrl('1IVHLrtBpaNHjhZtEHpdHmN_nlgzfVk7A'),  // r62
                driveUrl('1tSYNcrFupNbl9tYdE6sZMZeyMzBazfHa'),  // r63
                driveUrl('1xMp-G9saSKBWktYM8rAnSuWsvn2qpSrx'),  // r64
                driveUrl('1ZqjDfMp0a3X9_yqQluDt1q7YxEHiJUqu')   // r65
            ],

            // Videos PLACEBO (control de atenci√≥n) - p1 a p10
            placebo: [
                driveUrl('11eGJZYqVpXBMTiOECjd8UBOC4l3rx9HR'),  // p1
                driveUrl('1PYAUC22kpqqL8b1ecG_Qrg6Bb36GLxx5'),  // p2
                driveUrl('1EwfqdhdJ27gOmSaJUJVGvx7zneUOqlLm'),  // p3
                driveUrl('1lhSbel64fWuzkqo8jnT5m17rikuH0guL'),  // p4
                driveUrl('1Emj3p8cIs8SPXGNT5UDlbgozGeycFKn_'),  // p5
                driveUrl('1O7szddVCZpppur0W0Ufh_EKj_8D7VfjJ'),  // p6
                driveUrl('1INSZbM4HygRHqBxpJXJ7Tv_GzEjvpu4c'),  // p7
                driveUrl('1LGhpQWXNMu5kEr28VcIZwu3FKYCNDy0N'),  // p8
                driveUrl('1CxGXReLCUYz9lyu7KZFBhGZN0kV1AXwh'),  // p9
                driveUrl('1jhOXDX2sS5xpNpn5IyZR4w5Wt8jixsZU')   // p10
            ]
        };

        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function selectVideosForExperiment() {
            let selected = [];

            // NUEVA L√ìGICA DE SELECCI√ìN:
            // Total: 20 videos
            // - 4 placebos (control de atenci√≥n)
            // - 8 fakes (videos generados por IA)
            // - 8 reales (videos reales)

            // 1. Seleccionar 4 placebos aleatorios (o todos si hay menos de 4)
            const numPlacebos = Math.min(VIDEOS_POOL.placebo.length, 4);
            const selectedPlacebos = shuffleArray(VIDEOS_POOL.placebo).slice(0, numPlacebos);
            selected.push(...selectedPlacebos.map(path => ({
                path,
                tipo: 'placebo',
                es_fake: false, // Los placebos son videos evidentemente fake o real (para control)
                es_placebo: true
            })));

            // 2. Seleccionar 8 fakes aleatorios
            const selectedFakes = shuffleArray(VIDEOS_POOL.fakes).slice(0, 8);
            selected.push(...selectedFakes.map(path => ({
                path,
                tipo: 'fake',
                es_fake: true,
                es_placebo: false
            })));

            // 3. Seleccionar 8 reales aleatorios
            const selectedReales = shuffleArray(VIDEOS_POOL.reales).slice(0, 8);
            selected.push(...selectedReales.map(path => ({
                path,
                tipo: 'real',
                es_fake: false,
                es_placebo: false
            })));

            // Total: 4 + 8 + 8 = 20 videos
            // Mezclar el orden final
            return shuffleArray(selected);
        }

</script>
</body>
</html>
